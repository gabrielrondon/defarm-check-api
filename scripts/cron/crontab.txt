# DeFarm Check API - Cron Jobs para Atualização Automática de Dados
#
# Instalação:
#   crontab -e
#   (colar conteúdo deste arquivo)
#
# Ou usar o script de setup:
#   npm run cron:setup
#
# Logs:
#   Todos os jobs logam em logs/cron-*.log
#   Rotate automático (10MB max, 5 arquivos)
#
# IMPORTANTE:
#   - Ajustar PATH e NODE_PATH conforme seu ambiente
#   - Testar manualmente cada job antes de ativar cron
#   - Monitorar logs regularmente

# Variáveis de ambiente
SHELL=/bin/bash
PATH=/usr/local/bin:/usr/bin:/bin
NODE_PATH=/usr/local/bin/node

# Diretório do projeto (AJUSTAR CONFORME SEU AMBIENTE)
WORKDIR=/Users/gabrielrondon/defarm/check

#
# 1. DETER - Alertas de Desmatamento em Tempo Real
# Frequência: DIÁRIA (03:00)
# Importância: ALTA (monitoramento contínuo de desmatamento)
# Tempo estimado: 5-10 minutos
#
0 3 * * * cd $WORKDIR && tsx scripts/cron/update-deter.ts >> logs/cron-deter.log 2>&1

#
# 2. Lista Suja do Trabalho Escravo (MTE)
# Frequência: MENSAL (1º dia, 02:00)
# Importância: CRÍTICA (compliance legal)
# Tempo estimado: 3-5 minutos
#
0 2 1 * * cd $WORKDIR && tsx scripts/cron/update-lista-suja.ts >> logs/cron-lista-suja.log 2>&1

#
# 3. IBAMA Embargoes
# Frequência: SEMANAL (domingo, 02:00)
# Importância: ALTA (risco de multas)
# Tempo estimado: 10-15 minutos (155MB de download)
#
0 2 * * 0 cd $WORKDIR && tsx scripts/cron/update-ibama.ts >> logs/cron-ibama.log 2>&1

#
# 4. Dados Espaciais (Terras Indígenas + Unidades de Conservação)
# Frequência: MENSAL (1º dia, 04:00)
# Importância: MÉDIA (dados estáveis)
# Tempo estimado: 15-20 minutos
#
0 4 1 * * cd $WORKDIR && tsx scripts/cron/update-spatial-data.ts >> logs/cron-spatial-data.log 2>&1

#
# 5. CAR - Cadastro Ambiental Rural (Estados Prioritários)
# Frequência: MENSAL (dia 15, 03:00)
# Importância: ALTA (regularização ambiental)
# Tempo estimado: 30-60 minutos (apenas 10 estados)
#
0 3 15 * * cd $WORKDIR && tsx scripts/cron/update-car.ts >> logs/cron-car.log 2>&1

#
# 6. Monitoramento de Health (verificar se dados estão frescos)
# Frequência: DIÁRIA (08:00)
# Importância: MÉDIA (alertas de dados desatualizados)
# Tempo estimado: < 1 minuto
#
# 0 8 * * * cd $WORKDIR && tsx scripts/cron/check-data-freshness.ts >> logs/cron-health.log 2>&1

#
# 7. Limpeza de Logs Antigos
# Frequência: SEMANAL (domingo, 01:00)
# Remove logs > 30 dias
#
0 1 * * 0 find $WORKDIR/logs -name "*.log" -mtime +30 -delete

# Fim do crontab
